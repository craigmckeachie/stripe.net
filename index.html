<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Stripe.net by craigmckeachie</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Stripe.net</h1>
        <h2>Stripe.net is a full service .net api for http://stripe.com. See the readme below for examples on how to use it.</h2>
        <a href="https://github.com/craigmckeachie/stripe.net" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p><img src="http://i.imgur.com/9UzKGQd.png" alt="stripe.net">  </p>

<p>If you would like to donate to help support stripe.net, my paypal address is <a href="mailto:jaymedavis@gmail.com">jaymedavis@gmail.com</a>. It's certainly not required, but I would appreciate it. :)  </p>

<h2>
<a id="if-you-would-like-to-submit-a-pull-request" class="anchor" href="#if-you-would-like-to-submit-a-pull-request" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>If you would like to submit a pull request.</strong>
</h2>

<p>First, thank you! It is a lot of work to learn someone else's codebase, so I appreciate it. Here are a few things that would help me out:</p>

<ul>
<li>Do not submit pull requests for more than one fix. Keep them small and focused.</li>
<li>Please code review yourself. There are a lot of pull requests with typos and mistakes. Don't worry, we all do it. But a code review of yourself will help. :)</li>
<li>Please review the diff in GitHub that I will see before I merge your pull requests. If it's hard for you to tell what the differences are, it's going to be hard for me too.</li>
</ul>

<h2>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick Start</h2>

<p>It is recommended that you install Stripe.net via NuGet. If you wish to build it yourself via build.cmd, you will need
ruby installed along with the gems albacore and zip. You could also just build the assembly in Visual Studio by opening the solution and compiling.</p>

<p>Add a reference to Stripe.net.dll.</p>

<p>Next you will need to provide Stripe.net with your api key. There are 4 ways to do this:</p>

<p>a) Add an AppSetting with your api key to your config (this is the easiest way and will work throughout the app on every request)</p>

<pre><code>&lt;appSettings&gt;
...
    &lt;add key="StripeApiKey" value="[your api key here]" /&gt;
...
&lt;/appSettings&gt;
</code></pre>

<p>b) In your application initialization, call this method (this is a programmatic way, but you only have to do it once during startup)</p>

<pre><code>StripeConfiguration.SetApiKey("[your api key here]");
</code></pre>

<p>c) In any of the service constructors, you can optionally pass the api key (will be assigned that apikey for the life of the service instance).</p>

<pre><code>var planService = new StripePlanService("[your api key here]");
</code></pre>

<p>d) In any of the service calls, you can pass a <a href="#striperequestoptions">StripeRequestOptions</a> object with the apikey specified.</p>

<pre><code>var planService = new StripePlanService();
planService.Get(*planId*, new StripeRequestOptions() { ApiKey = "[your api key here]" });
</code></pre>

<h2>
<a id="stripe-api-version" class="anchor" href="#stripe-api-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stripe API Version</h2>

<p>Stripe.net forces a version of the Stripe API for which it was designed. You can find out the latest version supported by viewing StripeConfiguration.cs under the Infrastructure folder.</p>

<h1>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h1>

<h2>
<a id="plans" class="anchor" href="#plans" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plans</h2>

<h3>
<a id="creating-a-plan" class="anchor" href="#creating-a-plan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a plan</h3>

<p>If your site has multiple offerings, plans are perfect. You can create as many plans as you want and then just assign customers to those plans later on.</p>

<pre><code>var myPlan = new StripePlanCreateOptions();
myPlan.Amount = 1000;           // all amounts on Stripe are in cents, pence, etc
myPlan.Currency = "usd";        // "usd" only supported right now
myPlan.Interval = "month";      // "month" or "year"
myPlan.IntervalCount = 1;       // optional
myPlan.Name = "Bronze";
myPlan.TrialPeriodDays = 30;    // amount of time that will lapse before the customer is billed

var planService = new StripePlanService();
StripePlan response = planService.Create(myPlan);
</code></pre>

<p>The returned StripePlan entity above will have a unique Id. You will want to persist this for later. When you create a customer you will be able to assign them
to a plan id (or not)</p>

<h3>
<a id="updating-a-plan" class="anchor" href="#updating-a-plan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a plan</h3>

<pre><code>var myPlan = new StripePlanUpdateOptions();

myPlan.Name = "NEW Plan YO!";

var planService = new StripePlanService();
StripePlan response = planService.Update(*planId*, myPlan);
</code></pre>

<h3>
<a id="retrieving-a-plan" class="anchor" href="#retrieving-a-plan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a plan</h3>

<pre><code>var planService = new StripePlanService();
StripePlan response = planService.Get(*planId*);
</code></pre>

<h3>
<a id="deleting-a-plan" class="anchor" href="#deleting-a-plan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting a plan</h3>

<pre><code>var planService = new StripePlanService();
planService.Delete(*planId*);
</code></pre>

<h3>
<a id="list-all-plans" class="anchor" href="#list-all-plans" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all plans</h3>

<pre><code>var planService = new StripePlanService();
IEnumerable&lt;StripePlan&gt; response = planService.List(); // optional StripeListOptions
</code></pre>

<p><a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="coupons-queue-pons-not-coo-pons" class="anchor" href="#coupons-queue-pons-not-coo-pons" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coupons (queue-pons not coo-pons)</h2>

<h3>
<a id="creating-a-coupon" class="anchor" href="#creating-a-coupon" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a coupon</h3>

<pre><code>var myCoupon = new StripeCouponCreateOptions();
myCoupon.Id = "HOLIDAY10OFF";
myCoupon.PercentOff = "10";
myCoupon.Duration = "repeating";    // "forever", "once", or "repeating"
myCoupon.DurationInMonths = 3;      // valid when "repeating" only

// set these if you want to
myCoupon.MaxRedemptions = 100;
myCoupon.RedeemBy = '12/31/2012';

var couponService = new StripeCouponService();
StripeCoupon response = couponService.Create(myCoupon);
</code></pre>

<h3>
<a id="retrieving-a-coupon" class="anchor" href="#retrieving-a-coupon" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a coupon</h3>

<pre><code>var couponService = new StripeCouponService();
StripeCoupon response = couponService.Get(*couponId*);
</code></pre>

<h3>
<a id="deleting-a-coupon" class="anchor" href="#deleting-a-coupon" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting a coupon</h3>

<pre><code>var couponService = new StripeCouponService();
couponService.Delete(*couponId*);
</code></pre>

<h3>
<a id="list-all-coupons" class="anchor" href="#list-all-coupons" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all coupons</h3>

<pre><code>var couponService = new StripeCouponService();
IEnumerable&lt;StripeCoupon&gt; response = couponService.List();  // optional StripeListOptions
</code></pre>

<p><a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="tokens" class="anchor" href="#tokens" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tokens</h2>

<h3>
<a id="creating-a-token" class="anchor" href="#creating-a-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a token</h3>

<p>A token can be used anywhere on Stripe where you would normally pass a card. Once it's created, it can be used on a
customer or a charge, but only used once.</p>

<pre><code>var myToken = new StripeTokenCreateOptions();

// if you need this...
myToken.Card = new StripeCreditCardOptions()
{
    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
};

// set this property if using a customer (stripe connect only)
myToken.CustomerId = *customerId*;

var tokenService = new StripeTokenService();
StripeToken stripeToken = tokenService.Create(myToken);
</code></pre>

<p>Tokens are very useful if you don't want to store the customers credit card information on your servers (pci compliance).</p>

<h3>
<a id="retrieving-a-token" class="anchor" href="#retrieving-a-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a token</h3>

<pre><code>var tokenService = new StripeTokenService();
StripeToken stripeToken = tokenService.Get(*tokenId*);
</code></pre>

<h2>
<a id="customers" class="anchor" href="#customers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Customers</h2>

<h3>
<a id="creating-a-customer" class="anchor" href="#creating-a-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a customer</h3>

<p>When creating a customer, you can specify any plan they are on, any coupons that will apply,
a credit card or token, and various meta data.</p>

<pre><code>var myCustomer = new StripeCustomerCreateOptions();

// set these properties if it makes you happy
myCustomer.Email = "pork@email.com";
myCustomer.Description = "Johnny Tenderloin (pork@email.com)";

// setting up the card
myCustomer.Source = new StripeSourceOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

myCustomer.PlanId = *planId*;                          // only if you have a plan
myCustomer.TaxPercent = 20;                            // only if you are passing a plan, this tax percent will be added to the price.
myCustomer.Coupon = *couponId*;                        // only if you have a coupon
myCustomer.TrialEnd = DateTime.UtcNow.AddMonths(1);    // when the customers trial ends (overrides the plan if applicable)
myCustomer.Quantity = 1;                               // optional, defaults to 1

var customerService = new StripeCustomerService();
StripeCustomer stripeCustomer = customerService.Create(myCustomer);
</code></pre>

<p>Don't let this be intimidating - all of these fields are optional. You could just create a customer with an email if you wanted.</p>

<h3>
<a id="updating-a-customer" class="anchor" href="#updating-a-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a customer</h3>

<pre><code>var myCustomer = new StripeCustomerUpdateOptions();

// set these properties if it makes you happy
myCustomer.Email = "pork@email.com";
myCustomer.Description = "Johnny Tenderloin (pork@email.com)";

// setting up the card
myCustomer.Source = new StripeSourceOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

// this will set the default card to use for this customer
myCustomer.DefaultSource = *cardId*;

myCustomer.Coupon = *couponId*;    // only if you have a coupon

var customerService = new StripeCustomerService();
StripeCustomer stripeCustomer = customerService.Update(*customerId*, myCustomer);
</code></pre>

<h3>
<a id="retrieving-a-customer" class="anchor" href="#retrieving-a-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a customer</h3>

<pre><code>var customerService = new StripeCustomerService();
StripeCustomer stripeCustomer = customerService.Get(*customerId*);
</code></pre>

<h3>
<a id="deleting-a-customer" class="anchor" href="#deleting-a-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting a customer</h3>

<pre><code>See Stripe's documentation on deleting a customer for more information.

var customerService = new StripeCustomerService();
customerService.Delete(*customerId*);
</code></pre>

<h3>
<a id="list-all-customers" class="anchor" href="#list-all-customers" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all customers</h3>

<pre><code>var customerService = new StripeCustomerService();
IEnumerable&lt;StripeCustomer&gt; response = customerService.List(); // optional StripeCustomerListOptions
</code></pre>

<p>StripeCustomerListOptions supports <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering</p>

<h2>
<a id="subscriptions" class="anchor" href="#subscriptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Subscriptions</h2>

<h3>
<a id="creating-a-subscription" class="anchor" href="#creating-a-subscription" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a subscription</h3>

<pre><code>var subscriptionService = new StripeSubscriptionService();
StripeSubscription stripeSubscription = subscriptionService.Create(*customerId*, *planId*); // optional StripeSubscriptionCreateOptions
</code></pre>

<h3>
<a id="updating-a-subscription" class="anchor" href="#updating-a-subscription" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a subscription</h3>

<pre><code>var subscriptionService = new StripeSubscriptionService();
StripeSubscription stripeSubscription = subscriptionService.Update(*customerId*, *subscriptionId*); // optional StripeSubscriptionUpdateOptions
</code></pre>

<h3>
<a id="retrieving-a-subscription" class="anchor" href="#retrieving-a-subscription" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a subscription</h3>

<pre><code>var subscriptionService = new StripeSubscriptionService();
StripeSubscription stripeSubscription = subscriptionService.Get(*customerId*, *subscriptionId*);
</code></pre>

<h3>
<a id="canceling-a-subscription" class="anchor" href="#canceling-a-subscription" aria-hidden="true"><span class="octicon octicon-link"></span></a>Canceling a subscription</h3>

<pre><code>var subscriptionService = new StripeSubscriptionService();
subscriptionService.Cancel(*customerId*, *subscriptionId*); // optional cancelAtPeriodEnd flag
</code></pre>

<h3>
<a id="list-all-subscriptions-for-a-customer" class="anchor" href="#list-all-subscriptions-for-a-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all subscriptions for a customer</h3>

<pre><code>var subscriptionService = new StripeSubscriptionService();
IEnumerable&lt;StripeSubscription&gt; response = subscriptionService.List(*customerId*); // optional StripeListOptions
</code></pre>

<p><a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="cards" class="anchor" href="#cards" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cards</h2>

<h3>
<a id="creating-a-card" class="anchor" href="#creating-a-card" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a card</h3>

<p>When creating a card you can use either a card or a token</p>

<pre><code>var myCard = new StripeCardCreateOptions();

// setting up the card
myCard.Source = new StripeSourceOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

var cardService = new StripeCardService();
StripeCard stripeCard = cardService.Create(*customerId*, myCard); // optional isRecipient
</code></pre>

<h3>
<a id="retrieving-a-card" class="anchor" href="#retrieving-a-card" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a card</h3>

<pre><code>var cardService = new StripeCardService();
StripeCard stripeCard = cardService.Get(*customerId*, *cardId*); // optional isRecipient
</code></pre>

<h3>
<a id="updating-a-card" class="anchor" href="#updating-a-card" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a card</h3>

<pre><code>var myCard = new StripeCardUpdateOptions();

myCard.Name = "Cardy MyCardson"
myCard.ExpirationYear = "2016";
myCard.ExpirationMonth = "10";
myCard.AddressCountry = "US";
myCard.AddressLine1 = "1234 ComeOnBabySayYouLoveMe St";
myCard.AddressLine2 = "";
myCard.AddressState = "NC";
myCard.AddressCity = "Raleigh"
myCard.AddressZip = "27617";

var cardService = new StripeCardService();
StripeCard stripeCard = cardService.Update(*customerId*, *cardId*, myCard); // optional isRecipient
</code></pre>

<h3>
<a id="deleting-a-card" class="anchor" href="#deleting-a-card" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting a card</h3>

<pre><code>var cardService = new StripeCardService();
cardService.Delete(*customerId*, *cardId*); // optional isRecipient
</code></pre>

<h3>
<a id="list-all-cards" class="anchor" href="#list-all-cards" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all cards</h3>

<pre><code>var cardService = new StripeCardService();
IEnumerable&lt;StripeCard&gt; response = cardService.List(*customerId*); // optional StripeListOptions and isRecipient
</code></pre>

<p><a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="charges" class="anchor" href="#charges" aria-hidden="true"><span class="octicon octicon-link"></span></a>Charges</h2>

<h3>
<a id="creating-a-charge" class="anchor" href="#creating-a-charge" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a charge</h3>

<p>When creating a charge you can use either a card, customer, or a token. Only one is allowed.</p>

<pre><code>var myCharge = new StripeChargeCreateOptions();

// always set these properties
myCharge.Amount = 5153;
myCharge.Currency = "usd";

// set this if you want to
myCharge.Description = "Charge it like it's hot";

// setting up the card
myCharge.Source = new StripeSourceOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

// set this property if using a customer
myCharge.CustomerId = *customerId*;

// set this if you have your own application fees (you must have your application configured first within Stripe)
myCharge.ApplicationFee = 25;

// (not required) set this to false if you don't want to capture the charge yet - requires you call capture later
myCharge.Capture = true;

var chargeService = new StripeChargeService();
StripeCharge stripeCharge = chargeService.Create(myCharge);
</code></pre>

<h3>
<a id="retrieving-a-charge" class="anchor" href="#retrieving-a-charge" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a charge</h3>

<pre><code>var chargeService = new StripeChargeService();
StripeCharge stripeCharge = chargeService.Get(*chargeId*);
</code></pre>

<h3>
<a id="capturing-a-charge" class="anchor" href="#capturing-a-charge" aria-hidden="true"><span class="octicon octicon-link"></span></a>Capturing a charge</h3>

<p>If you set a charge to capture = false, you use this to capture the charge later. <em>amount</em> and <em>applicationFee</em> are not required.</p>

<pre><code>var chargeService = new StripeChargeService();
StripeCharge stripeCharge = chargeService.Capture(*chargeId*, *amount*, *applicationFee*);
</code></pre>

<h3>
<a id="list-all-charges" class="anchor" href="#list-all-charges" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all charges</h3>

<pre><code>var chargeService = new StripeChargeService();
IEnumerable&lt;StripeCharge&gt; response = chargeService.List(); // optional StripeChargeListOptions
</code></pre>

<p>StripeChargeListOptions supports a CustomerId, <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering</p>

<h2>
<a id="invoices" class="anchor" href="#invoices" aria-hidden="true"><span class="octicon octicon-link"></span></a>Invoices</h2>

<h3>
<a id="retrieving-an-invoice" class="anchor" href="#retrieving-an-invoice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving an invoice</h3>

<pre><code>var invoiceService = new StripeInvoiceService();
StripeInvoice response = invoiceService.Get(*invoiceId*);
</code></pre>

<h3>
<a id="retrieving-an-upcoming-invoice-for-a-single-customer" class="anchor" href="#retrieving-an-upcoming-invoice-for-a-single-customer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving an upcoming invoice (for a single customer)</h3>

<pre><code>var invoiceService = new StripeInvoiceService();
StripeInvoice response = invoiceService.Upcoming(*customerId*);
</code></pre>

<h3>
<a id="create-a-customer-invoice" class="anchor" href="#create-a-customer-invoice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a customer invoice</h3>

<pre><code>var invoiceService = new StripeInvoiceService();
StripeInvoice response = invoiceService.Create(*customerId*); // optional StripeInvoiceCreateOptions
</code></pre>

<h3>
<a id="updating-a-customer-invoice" class="anchor" href="#updating-a-customer-invoice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a customer invoice</h3>

<pre><code>var stripeInvoiceUpdateOptions = new StripeInvoiceUpdateOptions();
stripeInvoiceUpdateOptions.Closed = true;

var invoiceService = new StripeInvoiceService();
StripeInvoice response = invoiceService.Update(*invoiceId*, stripeInvoiceUpdateOptions);
</code></pre>

<h3>
<a id="paying-an-invoice" class="anchor" href="#paying-an-invoice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Paying an invoice</h3>

<pre><code>var invoiceService = new StripeInvoiceService();
StripeInvoice response = invoiceService.Pay(*invoiceId*);
</code></pre>

<h3>
<a id="list-all-invoices" class="anchor" href="#list-all-invoices" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all invoices</h3>

<pre><code>var invoiceService = new StripeInvoiceService();
IEnumerable&lt;StripeInvoice&gt; response = invoiceService.List(); // optional StripeInvoiceListOptions
</code></pre>

<p>StripeInvoiceListOptions supports a CustomerId, <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering</p>

<h2>
<a id="invoice-items" class="anchor" href="#invoice-items" aria-hidden="true"><span class="octicon octicon-link"></span></a>Invoice Items</h2>

<h3>
<a id="creating-an-invoice-item" class="anchor" href="#creating-an-invoice-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating an invoice item</h3>

<p>Any invoice items you create for a customer will be added to their bill.</p>

<pre><code>var myItem = new StripeInvoiceItemCreateOptions();
myItem.Amount = 1000;
myItem.Currency = "usd";            // "usd" only supported right now
myItem.CustomerId = *customerId*;
myItem.Description = "na";          // not required

var invoiceItemService = new StripeInvoiceItemService();
StripeInvoiceItem response = invoiceItemService.Create(myItem);
</code></pre>

<h3>
<a id="retrieving-an-invoice-item" class="anchor" href="#retrieving-an-invoice-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving an invoice item</h3>

<pre><code>var invoiceItemService = new StripeInvoiceItemService();
StripeInvoiceItem response = invoiceItemService.Get(*invoiceItemId*);
</code></pre>

<h3>
<a id="updating-an-invoice-item" class="anchor" href="#updating-an-invoice-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating an invoice item</h3>

<pre><code>var myUpdatedItem = new StripeInvoiceItemUpdateOptions();
myUpdatedItem.Amount = 1010;
myUpdatedItem.Currency = "usd";        // "usd" only supported right now
myUpdatedItem.Description = "test";    // not required

var invoiceItemService = new StripeInvoiceItemService();
StripeInvoiceItem response = invoiceItemService.Update(*invoiceItemId*, myUpdatedItem);
</code></pre>

<h3>
<a id="deleting-an-invoice-item" class="anchor" href="#deleting-an-invoice-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting an invoice item</h3>

<pre><code>var invoiceItemService = new StripeInvoiceItemService();
invoiceItemService.Delete(*invoiceItemId*);
</code></pre>

<h3>
<a id="list-all-invoice-items" class="anchor" href="#list-all-invoice-items" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all invoice items</h3>

<pre><code>var invoiceItemService = new StripeInvoiceItemService();
IEnumerable&lt;StripeInvoiceItem&gt; response = invoiceItemService.List(); // optional StripeInvoiceItemListOptions
</code></pre>

<p>StripeInvoiceItemListOptions supports a CustomerId, <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering</p>

<h2>
<a id="account" class="anchor" href="#account" aria-hidden="true"><span class="octicon octicon-link"></span></a>Account</h2>

<h3>
<a id="retrieving-your-account" class="anchor" href="#retrieving-your-account" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving your account</h3>

<pre><code>var accountService = new StripeAccountService();
StripeAccount response = accountService.Get();
</code></pre>

<h2>
<a id="balance" class="anchor" href="#balance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Balance</h2>

<h3>
<a id="retrieving-your-account-balance" class="anchor" href="#retrieving-your-account-balance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving your account balance</h3>

<pre><code>var balanceService = new StripeBalanceService();
StripeBalance response = balanceService.Get();
</code></pre>

<h3>
<a id="retrieving-a-specific-balance-transaction" class="anchor" href="#retrieving-a-specific-balance-transaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a specific balance transaction</h3>

<pre><code>var balanceService = new StripeBalanceService();
StripeBalanceTransaction transaction = balanceService.Get(*balanceTransactionId*);
</code></pre>

<h3>
<a id="listing-balance-transactions" class="anchor" href="#listing-balance-transactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Listing balance transactions</h3>

<pre><code>var balanceService = new StripeBalanceService();
IEnumerable&lt;StripeBalanceTransaction&gt; balanceTransactions = balanceService.List(); // optional StripeBalanceTransactionListOptions
</code></pre>

<p>StripeBalanceTransactionListOptions supports filtering by a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date created, a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date available, currency, source, transfer, type, and supports <a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="disputes" class="anchor" href="#disputes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Disputes</h2>

<h3>
<a id="updating-a-dispute" class="anchor" href="#updating-a-dispute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a dispute</h3>

<pre><code>var disputeService = new StripeDisputeService();

// providing the dispute reason is optional
StripeDispute stripeDispute = disputeService.Update(*chargeId*, "customer ate the donut before I charged them, so they said it was free");
</code></pre>

<h2>
<a id="recipients" class="anchor" href="#recipients" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recipients</h2>

<h3>
<a id="creating-a-recipient" class="anchor" href="#creating-a-recipient" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a recipient</h3>

<pre><code>var myRecipient = new StripeRecipientCreateOptions();
myRecipient.Name = "Bacon Industries Limited";
myRecipient.Type = "individual";                                        // "corporation" is also valid here.
myRecipient.TaxId = "000000000";                                        // optional
myRecipient.Email = "bacon@example.com";                                // optional
myRecipient.Description = "Bacon Industries Ltd. (bacon@example.com)";  //optional

// if you need this...
myRecipient.Card = new StripeCreditCardOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

var recipientService = new StripeRecipientService();
StripeRecipient stripeRecipient = recipientService.Create(myRecipient);
</code></pre>

<h3>
<a id="updating-a-recipient" class="anchor" href="#updating-a-recipient" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a recipient</h3>

<pre><code>var myRecipient = new StripeRecipientUpdateOptions();
myRecipient.Name = "Bacon Industries Limited";
myRecipient.TaxId = "000000000";                                        // optional
myRecipient.Email = "bacon@example.com";                                // optional
myRecipient.Description = "Bacon Industries Ltd. (bacon@example.com)";  // optional

// if you need this...
myRecipient.Card = new StripeCreditCardOptions()
{
    // set this property if using a token
    TokenId = *tokenId*,

    // set these properties if passing full card details (do not
    // set these properties if you set TokenId)
    Number = "4242424242424242",
    ExpirationYear = "2022",
    ExpirationMonth = "10",
    AddressCountry = "US",                // optional
    AddressLine1 = "24 Beef Flank St",    // optional
    AddressLine2 = "Apt 24",              // optional
    AddressCity = "Biggie Smalls",        // optional
    AddressState = "NC",                  // optional
    AddressZip = "27617",                 // optional
    Name = "Joe Meatballs",               // optional
    Cvc = "1223"                          // optional
}

var recipientService = new StripeRecipientService();
StripeRecipient stripeRecipient = recipientService.Update(*recipientId*, myRecipient);
</code></pre>

<h3>
<a id="retrieving-a-recipient" class="anchor" href="#retrieving-a-recipient" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a recipient</h3>

<pre><code>var recipientService = new StripeRecipientService();
StripeRecipient stripeRecipient = recipientService.Get(*recipientId*);
</code></pre>

<h3>
<a id="deleting-a-recipient" class="anchor" href="#deleting-a-recipient" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting a recipient</h3>

<pre><code>var recipientService = new StripeRecipientService();
recipientService.Deleted(*recipientId*);
</code></pre>

<h3>
<a id="list-all-recipients" class="anchor" href="#list-all-recipients" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all recipients</h3>

<pre><code>var recipientService = new StripeRecipientService();
IEnumerable&lt;StripeRecipient&gt; response = recipientService.List(); // optional StripeRecipientListOptions
</code></pre>

<p>StripeRecipientListOptions supports a verified flag and <a href="#stripelistoptions-paging">StripeListOptions</a> for paging</p>

<h2>
<a id="transfers" class="anchor" href="#transfers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transfers</h2>

<h3>
<a id="creating-a-transfer-to-a-recipient" class="anchor" href="#creating-a-transfer-to-a-recipient" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a transfer to a recipient</h3>

<pre><code>var myTransfer = new StripeTransferCreateOptions();
myTransfer.Amount = 100;
myTransfer.Currency = "usd";
myTransfer.Recipient = "*recipientId*";          // can also be "self" if you want to send to your own account
myTransfer.Description = "Sales Week #42";       // optional
myTransfer.StatementDescription = "Commissions"; // optional

var transferService = new StripeTransferService();
StripeTransfer stripeTransfer = transferService.Create(myTransfer);
</code></pre>

<h3>
<a id="retrieving-a-transfer" class="anchor" href="#retrieving-a-transfer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving a transfer</h3>

<pre><code>var transferService = new StripeTransferService();
StripeTransfer stripeTransfer = transferService.Get(*transferId*);
</code></pre>

<h3>
<a id="cancel-a-transfer" class="anchor" href="#cancel-a-transfer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cancel a transfer</h3>

<pre><code>var transferService = new StripeTransferService();
StripeTransfer stripeTransfer = transferService.Cancel(*transferId*);
</code></pre>

<h3>
<a id="list-all-transfers" class="anchor" href="#list-all-transfers" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all transfers</h3>

<pre><code>var transferService = new StripeTransferService();
IEnumerable&lt;StripeTransfer&gt; response = transferService.List(); // optional StripeTransferListOptions
</code></pre>

<p>StripeTransferListOptions supports a RecipientId, Status ('pending', 'paid' or 'failed'), <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering (on both the created and date fields)</p>

<h2>
<a id="application-fees" class="anchor" href="#application-fees" aria-hidden="true"><span class="octicon octicon-link"></span></a>Application Fees</h2>

<p>If you do not specify an amount, the entire application fee is refunded.</p>

<h3>
<a id="retrieving-an-application-fee" class="anchor" href="#retrieving-an-application-fee" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving an application fee</h3>

<pre><code>var feeService = new StripeApplicationFeeService();
StripeApplicationFee stripeApplicationFee = feeService.Get(*applicationFeeId*);
</code></pre>

<h3>
<a id="refunding-an-application-fee" class="anchor" href="#refunding-an-application-fee" aria-hidden="true"><span class="octicon octicon-link"></span></a>Refunding an application fee</h3>

<pre><code>var feeService = new StripeApplicationFeeService();
StripeApplicationFee stripeApplicationFee = feeService.Refund(*applicationFeeId*, *amount*);
</code></pre>

<h2>
<a id="stripelistoptions-paging" class="anchor" href="#stripelistoptions-paging" aria-hidden="true"><span class="octicon octicon-link"></span></a>StripeListOptions (paging)</h2>

<p>All Stripe List methods support paging, using <code>limit</code>, <code>starting_after</code> and <code>ending_before</code> properties.  If you do not specify any options, <code>limit</code> will default to 10. Some examples of retrieving paged data from the StripeChargeService:</p>

<pre><code>var chargeService = new StripeChargeService();

// get the first five results
IEnumerable&lt;StripeCharge&gt; firstPage = chargeService.List(new StripeChargeListOptions {
Limit = 5
});

// get the next five results
IEnumerable&lt;StripeCharge&gt; nextPage = chargeService.List(new StripeChargeListOptions {
Limit = 5,
StartingAfter = firstPage.Last().Id
});

// get the previous five results again
IEnumerable&lt;StripeCharge&gt; previousPage = chargeService.List(new StripeChargeListOptions {
    Limit = 5,
    EndingBefore = nextPage.First().Id
});
</code></pre>

<h2>
<a id="stripedatefilter-date-filtering" class="anchor" href="#stripedatefilter-date-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>StripeDateFilter (date filtering)</h2>

<p>Many of the List methods support parameters to filter by date. To use this, use the <code>StripeDateFilter</code> class. You can combine the filters to make complex queries. Some examples are:</p>

<pre><code>var chargeService = new StripeChargeService();

var chargesToday = chargeService.List(new StripeChargeListOptions {
    Created = new StripeDateFilter { GreaterThanOrEqual = DateTime.UtcNow.Date }
});

var chargesYesterday = chargeService.List(new StripeChargeListOptions {
    Created = new StripeDateFilter {
        GreaterThanOrEqual = DateTime.Now.AddDays(-1).Date,
        LessThan = DateTime.Now.Date
    }
});
</code></pre>

<h2>
<a id="expandable-properties" class="anchor" href="#expandable-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Expandable Properties</h2>

<p>Many of the services support <em>expandable</em> properties. Setting an expandable property to true means you want the entire object back instead of just the id.</p>

<p>For example:</p>

<pre><code>var chargeService = new StripeChargeService();
chargeService.ExpandBalanceTransaction = true;
chargeService.ExpandCustomer = true;
chargeService.ExpandInvoice = true;

StripeCharge stripeCharge = chargeService.Get(*chargeId*);
</code></pre>

<p>When the StripeCharge is returned, the Customer, BalanceTransaction, and Invoice properties will be hydrated objects.</p>

<h2>
<a id="events" class="anchor" href="#events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Events</h2>

<p>Stripe sends Events (via webhooks) whenever an associated action occurs. The list of events Stripe sends is documented here: <a href="https://stripe.com/docs/api#event_types">https://stripe.com/docs/api#event_types</a></p>

<h3>
<a id="receiving-events-from-stripe" class="anchor" href="#receiving-events-from-stripe" aria-hidden="true"><span class="octicon octicon-link"></span></a>Receiving events from Stripe</h3>

<p>1) In your application, create a handler that looks something like the below:</p>

<pre><code>namespace TheBestApplicationEverCreated
{
    public class StripeHandler : IHttpHandler
    {
        public bool IsReusable
        {
            get { return true; }
        }

        public void ProcessRequest(HttpContext context)
        {
            var json = new StreamReader(context.Request.InputStream).ReadToEnd();

            var stripeEvent = StripeEventUtility.ParseEvent(json);

            switch (stripeEvent.Type)
            {
                case StripeEvents.ChargeRefunded:  // all of the types available are listed in StripeEvents
                    var stripeCharge = Stripe.Mapper&lt;StripeCharge&gt;.MapFromJson(stripeEvent.Data.Object.ToString());
                    break;
            }
        }
    }
}
</code></pre>

<p>2) Create a StripeHandler.ashx in the root of your website (or wherever) that looks like this:</p>

<pre><code>&lt;%@ WebHandler Language="C#" Class="StripeHandler" CodeBehind="StripeHandler.cs" %&gt;
</code></pre>

<p>3) Login to Stripe and go to Account Settings, webhooks - from here, you can setup the url that points to your StripeHandler.ashx for testing.</p>

<p>Whenever an Event is received, StripeEventUtility.ParseEvent(json) will convert the response into a <em>StripeEvent</em> object.</p>

<h3>
<a id="retrieving-an-event" class="anchor" href="#retrieving-an-event" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving an event</h3>

<p>If you have the id and you want to retrieve the event</p>

<pre><code>var eventService = new StripeEventService();
StripeEvent response = eventService.Get(*eventId*)
</code></pre>

<h3>
<a id="list-all-events" class="anchor" href="#list-all-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>List all events</h3>

<p>You can list events in the same way everything else works in Stripe.net.</p>

<pre><code>var eventService = new StripeEventService();
IEnumerable&lt;StripeEvent&gt; response = eventService.List(); // optional StripeEventListOptions
</code></pre>

<p>StripeEventListOptions supports a type, <a href="#stripelistoptions-paging">StripeListOptions</a> for paging, and a <a href="#stripedatefilter-date-filtering">StripeDateFilter</a> for date filtering</p>

<h2>
<a id="stripe-connect" class="anchor" href="#stripe-connect" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stripe Connect</h2>

<p>The Stripe Connect documentation can be a little intimidating, so I am going to try to break it down a little. Stripe Connect gives you the ability to accept money on behalf of other accounts, 
and access or modify connected accounts depending on permissions.</p>

<p>1) The first thing you need to do is <a href="https://dashboard.stripe.com/account/applications/settings">register your platform</a> with Stripe Connect. Stripe.net at this time only supports 
<a href="https://stripe.com/docs/connect/standalone-accounts">Standalone Accounts</a>, which is very useful because it supports every country Stripe supports. Managed Accounts are a 
valuable service as well, but they are not available in Stripe.net yet.</p>

<p>2) The next thing to do, is have another party connect to your site. To do this, put a link on your site which will start the authorization process, or you can use a 
<a href="https://stripe.com/about/resources">Stripe Connect Button</a>. Your link will need to contain some querystring paramaters:</p>

<pre><code>response_type: code
client_id:     *your client id from the stripe connect dashboard*
scope:         read_only (default), or read_write (lets you modify their data as well) // this is optional and defaults to read_only
redirect_uri:  this is optional, and will return the user to this page when the connection is complete
other options are available and you can learn more about them with the [Connect OAuth Reference](https://stripe.com/docs/connect/reference)
</code></pre>

<p>3) When the user clicks the link on your site, they will be prompted to authorize the connection. At this point, they can create a new Stripe account or setup the connection with an existing account.</p>

<p>Your link will look something like this:</p>

<pre><code>https://connect.stripe.com/oauth/authorize?response_type=code&amp;client_id=*your_client_id_from_the_stripe_connect_dashboard&amp;scope=read_write
</code></pre>

<p>4) The link above will return a code when the setup is complete (and also return back to your redirect_uri if specified). With this code, you can make a request to Stripe to get the StripeUserId for accessing
their account.</p>

<p>In Stripe.net, you can accomplish this with the following code:</p>

<pre><code>var stripeOAuthTokenService = new StripeOAuthTokenService();
var stripeOAuthTokeCreateOptions = new StripeOAuthTokenCreateOptions()
{
    ClientSecret = ConfigurationManager.AppSettings["StripeApiKey"],
    Code = *the code returned from above*,
    GrantType = "authorization_code"
};

StripeOAuthToken stripeOAuthToken = stripeOAuthTokenService.Create(_stripeOAuthTokeCreateOptions);
</code></pre>

<p>5) You're done! Whenever you need to access the connected account, you simply need the StripeUserId from the StripeOAuthToken to be passed as part of the <a href="#striperequestoptions">StripeRequestOptions</a> 
which all service calls now support as an optional parameter.</p>

<p>For example, to get the plans on the connected account, you could run the following code:</p>

<pre><code>var planService = new StripePlanService();
StripePlan response = planService.List(null /* StripeListOptions */, new StripeRequestOptions() { StripeConnectAccountId = *the StripeUserId on the StripeOAuthToken above* });
</code></pre>

<p>Depending on if your permissions are read_write or read_only, you can do anything on the connected account you can do on your own account just by passing the StripeUserId as
part of StripeRequestOptions.</p>

<h2>
<a id="striperequestoptions" class="anchor" href="#striperequestoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>StripeRequestOptions</h2>

<p>All of the service methods accept an optional StripeRequestOptions object. This is used if you need an <a href="https://stripe.com/docs/api?lang=curl#idempotent_requests">Idempotency Key</a>, 
if you are using Stripe Connect, or if you want to pass the ApiKey on each method.</p>

<pre><code>var requestOptions = new StripeRequestOptions();
requestOptions.ApiKey = *optional*;              // this is not required unless you choose to pass the apikey on every service call
requestOptions.IdempotencyKey = "some string";   // this is for Idempotent Requests - https://stripe.com/docs/api?lang=curl#idempotent_requests
requestOptions.StripeConnectAccountId = "acct_*" // if you are using Stripe Connect and want to issue a request on the connected account
</code></pre>

<h2>
<a id="errors" class="anchor" href="#errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Errors</h2>

<p>Any errors that occur on any of the services will throw a StripeException with the message returned from Stripe. It is a good idea to run your service calls in a try and catch StripeException.</p>

<p>The StripeException contains and HttpStatusCode and a StripeError entity. The StripeError entity contains the type, message, code and param. For more infomation, review the Errors section
of stripe here: <a href="https://stripe.com/docs/api#errors">https://stripe.com/docs/api#errors</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/craigmckeachie/stripe.net/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/craigmckeachie/stripe.net/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/craigmckeachie/stripe.net"></a> is maintained by <a href="https://github.com/craigmckeachie">craigmckeachie</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
